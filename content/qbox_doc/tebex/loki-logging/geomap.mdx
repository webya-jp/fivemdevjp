---
title: GTA Vマップ
sidebar_label: GTA Vマップ
keywords: [qbox, fivem, loki-logging, GTA Vマップ]
description: GrafanaでGTA Vのデータを地図上に視覚化する方法について説明します。
---

Grafanaのもう一つの素晴らしい機能は、データを地図上に視覚化できることだ。これは特にFiveMで、どこで何が起こったかを視覚的に確認したい場合に便利だ。
:::info
デフォルトでは、このリソースはすべてのプレーヤーの切断を記録します。これには通常の切断やクラッシュなども含まれます。また、サーバー上の爆発もすべて記録します。
:::
:::warning
コメントアウトされたコードもあります。**すべて**プレイヤーの位置は15秒ごとに表示されます。サーバーの規模にもよりますが、これは**トン**のログが記録され、パフォーマンスが低下する可能性が高くなります。自己責任で使用してください！
:::

![Preview Example](https://media.qbox.re/image/qJeZjKiL8aGnUiXNvzngid9uwqicgpdJ6KR0.png)

## セットアップ

私たちは、あなたが始めることができるように、上記の例のためのプレメイドリソースを用意しています。私たちの[ギットハブ](https://github.com/Qbox-project/qbx_grafana_map).
好きな場所にインストールできる。しかしこの場合は`[qbx]`フォルダに残りを入れる！

さて、このリソースが生成するログを実際に可視化するには、Grafanaで新しいダッシュボードを作成する必要がある。
まだお気づきでなければ、リソースには`geomap.json`ファイルを作成します。このファイルの内容をコピーし、Grafana Dashboardsタブに移動します。
右上に大きな青いボタンがあります。`New`.それをクリックして`Import`をドロップダウンメニューから選択する。次に`geomap.json`ファイルをテキストエリアに入力し`Load`そして`Import`.
そしてそこにある！新しいジオマップダッシュボード。

<ReactPlayer
  url="https://media.qbox.re/video/c6wX8jrRqNp3uNgGN_93OCvgrutgIwzy.mp4"
  controls={true}
  width="100%"
  height="100%"
  loop={true}
  playing={true}
/>

## 代替利用

何でもそうだが、これらはジオマップをどのように使うことができるかについてのいくつかの例に過ぎない。すべてがオープンソースでカスタマイズ可能なので、リソースを好みに変えたり、Grafanaダッシュボードを変えたり、なんでもできる！イッピー！
お気づきかもしれないが、ページ上部にはイベントフィルターがある。このダッシュボードをさまざまなユースケースで使用する場合は、このフィルターにイベントを追加する必要があります。

1. 右上の編集モードに入る
2. をクリックしてください。`settings`ボタン
3. に行く。`Variables`タブ
4. アンダー`Custom Options`カスタムイベントをカンマ区切りで追加する。
   ![Preview Example](https://media.qbox.re/image/Jrmbwa8Q-yQKWRJHMJHZ8U7Te9W2HU68MZM7WOAk.png)

さて、実際にイベントをログに記録するには、次のように`ox_lib`ロガー関数。ワールド座標はジオマップ座標と重ならない。まず座標を変換する必要がある、
そのために`qbx_grafana_map`リソースが変換してくれる。

```lua
    local coords = GetEntityCoords(PlayerPedId())
    local lon, lat = exports.qbx_grafana_map:gameToMap(coords.x, coords.y)
    lib.logger(playerSource, 'custom_event', 'custom_message', ('lon:%s'):format(lon), ('lat:%s'):format(lat))
```

重要なのは`lon`そして`lat`値に変換されます。これらは、ロガー関数で使用できる変換された座標です。常に追加引数としてこれらを含めてください！そうしないと、ジオマップはログがどこで行われたかを知ることができません。

## 別の地図が欲しい！

幸いなことにこれは可能で、3つの地図から選ぶことができます！地図にカーソルを合わせ、3つの点をクリックしてください。`Edit`.右側の`Basemap layer`を選択すると、URLテンプレートを以下の3つのオプションに変更できる。

<Columns>
  <Column>
    ![Preview Example](https://media.qbox.re/image/GMl5STcVpsl_vQZA0o0QyidyYkrVWJ5pvrI.png)
  </Column>

  <Column>
    ![Preview Example](https://media.qbox.re/image/FcYKuE6-zWQhcZYimn0EhITy3EvdaY3F9GPigbbHKh4Yhbe.png)
  </Column>
</Columns>

<Columns>
  <Column style={{ maxWidth: '300px'}}>
    <CardHeader>
      `https://s.rsg.sc/sc/images/games/GTAV/map/render/{z}/{x}/{y}.jpg`
    </CardHeader>

    <CardImage cardImageUrl="https://media.qbox.re/image/tUcW4OwJbbSuRa0bvbjUAE4o6b0lEOkulAlTVU1OwShY.png" />

  </Column>

  <Column style={{ maxWidth: '300px'}}>
    <CardHeader>
      `https://s.rsg.sc/sc/images/games/GTAV/map/game/{z}/{x}/{y}.jpg`
    </CardHeader>

    <CardImage cardImageUrl="https://media.qbox.re/image/aIrx9DVQj-Kk9lRRCeP-BubhmKLb_WYI.png" />

  </Column>

  <Column style={{ maxWidth: '300px'}}>
    <CardHeader>
      `https://s.rsg.sc/sc/images/games/GTAV/map/print/{z}/{x}/{y}.jpg`
    </CardHeader>

    <CardImage cardImageUrl="https://media.qbox.re/image/6la89HhcEFqsRMTcAbREQlWrahcyvs6YXffRPBeZwFhn3.png" />

  </Column>
</Columns>

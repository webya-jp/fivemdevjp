---
description: Learn how to write optimized code!
---

# ğŸš€ ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æœ€é©åŒ–

### ä¸€èˆ¬è¨ºç™‚

**é–¢æ•°ã¨å¤‰æ•°ã‚’ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºã™ã‚‹**

* Luaã¯ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã‚„é–¢æ•°ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚„é–¢æ•°ã‚ˆã‚Šã‚‚é«˜é€Ÿã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚å¸¸ã«`local`æ˜ç¤ºçš„ã«ã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ã‚ã‚‹å¿…è¦ãŒãªã„é™ã‚Šã€å¤‰æ•°ã¾ãŸã¯é–¢æ•°ã‚’å®£è¨€ã™ã‚‹ã¨ã

```lua
myVariable = false -- Don't use this
local myVariable = false -- Use this

function someFunction() -- Don't use this
    print('Im a global function!')
end

local function someFunction() -- Use this
    print('Im a local function!')
end
```

**ä»£ã‚ã‚Šã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹`table.insert`**

* `table.insert`è‹¥å¹²ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒç™ºç”Ÿã—ã¾ã™ã€‚å€¤ã‚’ç›´æ¥å‰²ã‚Šå½“ã¦ã‚‹æ–¹ãŒåŠ¹ç‡çš„ã§ã™ã€‚

```lua
function someFunction()
    local table = {}
    table.insert(table, {}) -- Don't use this
    table[#table+1] = {} -- Use this
end
```

**æ¡ä»¶ãƒã‚§ãƒƒã‚¯ã‚’ç°¡ç´ åŒ–ã™ã‚‹**

* ä½¿ç”¨ `if something then` ã®ä»£ã‚ã‚Šã« `if something ~= nil`ä¸¡æ–¹ã‚’ç¢ºèªã™ã‚‹`nil` ãã—ã¦ `false`

```lua
function someFunction()
    local bool = nil
    
    if bool ~= nil then -- Don't use this
        print('bool was not nil but also could be false!')
    end
    
    if bool then -- Use this
        print('bool was neither nil or false!')
    end
end
```

**é–¢æ•°ã‚’æ™®éçš„ã«ä¿ã¤**

* ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã™ã“ã¨ã§è¤‡æ•°ã®ã‚·ãƒŠãƒªã‚ªã«å¯¾å¿œã§ãã‚‹é–¢æ•°ã‚„ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨˜è¿°ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã‚³ãƒ¼ãƒ‰ã®å†åˆ©ç”¨æ€§ãŒå‘ä¸Šã—ã¾ã™ã€‚

```lua
local function someFunction(param1, param2, param3)
    print('Im a function that accepts 3 parameters which allows for multiple conditions!')
    if param1 == 'something' then
        print('I met condition number one!')
    elseif param2 == 'somethingelse' then
        print('I met condition number two!')
    elseif param3 == 'somethingelsemore' then
        print('I met condition number three!')
    end
end

RegisterNetEvent('someEvent', function(param1, param2, param3)
    print('Im an event that accepts 3 parameters which allows for multiple conditions!')
    if param1 == 'something' then
        print('I met condition number one!')
    elseif param2 == 'somethingelse' then
        print('I met condition number two!')
    elseif param3 == 'somethingelsemore' then
        print('I met condition number three!')
    end
end)
```

**ã‚·ãƒ§ãƒ¼ãƒˆãƒªã‚¿ãƒ¼ãƒ³**

* ä½¿ç”¨ **ã‚·ãƒ§ãƒ¼ãƒˆãƒªã‚¿ãƒ¼ãƒ³**æ¡ä»¶ãŒæº€ãŸã•ã‚Œãªã„å ´åˆã«é–¢æ•°ã‚’æ—©æœŸã«çµ‚äº†ã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šã‚³ãƒ¼ãƒ‰ãŒæ•´ç†ã•ã‚Œã€ä¸è¦ãªãƒã‚¹ãƒˆãŒå›é¿ã•ã‚Œã‚‹ã€‚`if`ãƒ–ãƒ­ãƒƒã‚¯

```lua
local function someFunction(param1, param2, param3)
    if not param1 then return end
    print('I met condition number one!')
    if not param2 then return end
    print('I met condition number two!')
    if not param3 then return end
    print('I met condition number three!')
end
```

**ãƒ†ãƒ¼ãƒ–ãƒ«ã‚„å¤‰æ•°ã‚’ç¹°ã‚Šè¿”ã—å†ä½œæˆã—ãªã„ã‚ˆã†ã«ã™ã‚‹**

* ãƒ«ãƒ¼ãƒ—ã‚„é »ç¹ã«å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°å†…ã§ãƒ†ãƒ¼ãƒ–ãƒ«ã‚„å¤‰æ•°ã‚’ç¹°ã‚Šè¿”ã—ä½œæˆã™ã‚‹ã®ã§ã¯ãªãã€ä¸€åº¦åˆæœŸåŒ–ã—ã¦å†åˆ©ç”¨ã—ã¾ã™ã€‚

```lua
local reusableTable = {}

local function someFunction()
    for i = 1, 10 do
        reusableTable[i] = i -- Reuse the same table instead of creating a new one
    end
end
```

**ä½¿ç”¨ `nil`ãƒ¡ãƒ¢ãƒªã‚’è§£æ”¾ã™ã‚‹**

* æœªä½¿ç”¨ã®å¤‰æ•°ã‚’å‰²ã‚Šå½“ã¦ã‚‹`nil`Luaã®ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼ãŒãƒ¡ãƒ¢ãƒªã‚’è§£æ”¾ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

```lua
local largeData = {1, 2, 3, 4}
-- Process data...
largeData = nil -- Free up memory when done
```

**ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’é¿ã‘ã‚‹**

* è¨­å®šå¯èƒ½ãªå€¤ï¼ˆåº§æ¨™ã€ã‚¢ã‚¤ãƒ†ãƒ åã€æ”¯æ‰•é‡‘é¡ãªã©ï¼‰ã‚’ä¸€å…ƒç®¡ç†ã—ã¾ã™ã€‚`config.lua`ç®¡ç†ã‚’å®¹æ˜“ã«ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

**ä¾‹ `config.lua`**:

```lua
Config = {
    Zones = {
        PoliceStation = vector3(441.1, -981.1, 30.7),
        Hospital = vector3(1151.21, -1529.62, 34.84)
    },
    Payments = {
        Police = 150,
        EMS = 120
    }
}
```

**ãƒ­ã‚°ã¨ãƒ‡ãƒãƒƒã‚°**

* ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡ã‚Šæ›¿ãˆã‚’ä½¿ç”¨ã™ã‚Œã°ã€ãƒ­ã‚°ã‚’å‰Šé™¤ã›ãšã«å‹•çš„ã«ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–ã¾ãŸã¯ç„¡åŠ¹åŒ–ã§ãã¾ã™ã€‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦è¿½åŠ ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚`config.lua`ä¸Šã‹ã‚‰ï¼

```lua
local DEBUG = true

local function debugLog(message)
    if DEBUG then
        print(message)
    end
end

debugLog('This is a debug message!')
```

**ãƒˆãƒ©ãƒƒã‚¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**

* ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒé‡è¦ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œæ™‚é–“ã‚’æ¸¬å®šã—ã¾ã™ã€‚`os.clock()`ã¾ãŸã¯FiveMãƒã‚¤ãƒ†ã‚£ãƒ–

```lua
local start = os.clock()
-- Code to measure
print("Execution time:", os.clock() - start)
```

```lua
local startTime = GetGameTimer()
-- Simulate a delay
Wait(1000)
local endTime = GetGameTimer()
print("Execution time (ms):", endTime - startTime) -- Output: 1000 (approx)
```

**ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®éå‰°ãªä½¿ç”¨ã‚’é¿ã‘ã‚‹**

* å…±æœ‰çŠ¶æ…‹ã‚’ä½¿ç”¨ã™ã‚‹ï¼ˆä¾‹ï¼š`state bags` ã¾ãŸã¯ `entity states`ï¼‰ã‚¹ãƒ‘ãƒ ã§ã¯ãªãã€é »ç¹ãªãƒ‡ãƒ¼ã‚¿åŒæœŸãŒå¿…è¦ãªå ´åˆ`TriggerEvent` ã¾ãŸã¯ `TriggerServerEvent`

```lua
-- Set state
Entity(playerPed).state:set('exampleData', 123, true)

-- Get state
local data = Entity(playerPed).state.exampleData
print(data) -- Outputs: 123
```

**ãƒ‡ãƒ¼ã‚¿è»¢é€ã®æœ€é©åŒ–**

* ãƒ†ãƒ¼ãƒ–ãƒ«å…¨ä½“ã‚„å¤§ããªãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã§ã¯ãªãã€å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’é€ä¿¡ã—ã¾ã™

```lua
TriggerServerEvent('exampleEvent', { x = 100, y = 200 }) -- Only send necessary fields
```

***

### ã‚³ãƒ¼ãƒ‰ã®èª­ã¿ã‚„ã™ã•

ã‚³ãƒ¼ãƒ‰ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä»˜ã‘ã‚‹

* ç‰¹ã«è¤‡é›‘ãªéƒ¨åˆ†ã‚„ã‚ã‹ã‚Šã«ãã„éƒ¨åˆ†ã«ã¯ã€ãƒ­ã‚¸ãƒƒã‚¯ã‚’èª¬æ˜ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```lua
-- Check if the player is in range of the target zone
if #(playerCoords - targetCoords) < 10 then
    print('Player is in range')
end
```

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ•´ç†ã™ã‚‹

* ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è«–ç†çš„ã«æ§‹é€ åŒ–ã—ã€å¤‰æ•°ã€é–¢æ•°ã€ã‚¤ãƒ™ãƒ³ãƒˆ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã€ã‚³ã‚¢ ãƒ­ã‚¸ãƒƒã‚¯ã‚’å€‹åˆ¥ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åˆ†é›¢ã—ã¾ã™ã€‚

```lua
-- Variables
local QBCore = exports['qb-core']:GetCoreObject()

-- Functions
local function calculateDistance(pos1, pos2)
    return #(pos1 - pos2)
end

-- Events
RegisterNetEvent('exampleEvent', function()
    print('Event triggered!')
end)

-- Main Logic
CreateThread(function()
    print('Script started!')
end)
```

**ãƒ•ã‚©ãƒ«ãƒ€æ§‹é€ **

* ã™ã¹ã¦ã‚’ 1 ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«è¨˜è¿°ã™ã‚‹ã®ã§ã¯ãªãã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚ˆã‚Šå°ã•ãç®¡ç†ã—ã‚„ã™ã„éƒ¨åˆ†ã«åˆ†å‰²ã—ã¾ã™ã€‚

```
my_script/
â”œâ”€â”€ client/
â”‚   â”œâ”€â”€ main.lua
â”‚   â”œâ”€â”€ utils.lua
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ main.lua
â”‚   â”œâ”€â”€ events.lua
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ config.lua
â””â”€â”€ fxmanifest.lua
```

***

### ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ä½¿ç”¨æ³•

* å¸¸ã«äº¤æ›ã™ã‚‹`GetPlayerPed(-1)` ã¨ `PlayerPedId()`

```lua
local function someFunction()
    local ped = GetPlayerPed(-1) -- Don't use this
    local ped = PlayerPedId() -- Use this
end
```

* å¸¸ã«äº¤æ›ã™ã‚‹`GetDistanceBetweenCoords`lua math åˆ¥å`#(vector3 - vector3)`

```lua
local function someFunction()
    local ped = PlayerPedId()
    local pCoords = GetEntityCoords(ped)
    local coords = vector3(-29.53, -1103.67, 26.42)
    
    local dist = GetDistanceBetweenCoords(pCoords, coords, true) -- Don't use this
    local dist = #(pCoords - coords) -- Use this
    
    if dist < 5 then
        print('Im within 5 distance units of the coords!')
    end
end
```

***

### ãƒ«ãƒ¼ãƒ—

* whileãƒ«ãƒ¼ãƒ—ã¨ãã®å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’åˆ¶å¾¡ã™ã‚‹

```lua
local function exampleLoop()
    CreateThread(function()
        while listen do
            print('running while loop only when needed')
            Wait(0)
        end
    end)
end

local listen = false
CreateThread(function()
    LoopZone = CircleZone:Create(vector3(-851.63, 74.36, 51.86), 5.0, {
        name = "ExampleLoop",
        debugPoly = true,
    })
    LoopZone:onPlayerInOut(function(isPointInside)
        if isPointInside then
            listen = true
            exampleLoop() -- Initiate loop
        else
            listen = false -- turns off when your outside the zone
        end
    end)
end)
```

* ã€Œwhileã€ãƒ«ãƒ¼ãƒ—ã‚’å«ã‚€ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€å¯èƒ½ãªé™ã‚Šã€Œwhile true doã€ã®ä½¿ç”¨ã‚’é¿ã‘ã¦ãã ã•ã„ã€‚ã©ã†ã—ã¦ã‚‚ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆã¯ã€æ¬¡ã®ãƒ’ãƒ³ãƒˆã«å¾“ã†ã¨ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ã¯ãã‚Œã»ã©å¤§ããã‚ã‚Šã¾ã›ã‚“ã€‚
* ã‚¹ãƒ¬ãƒƒãƒ‰ã®æ™‚é–“ã‚’åˆ¶å¾¡ã™ã‚‹ã«ã¯ã€å¾…æ©Ÿæ™‚é–“ã‚’é¡åŠçš„ã«å¤‰æ›´ã™ã‚‹å¤‰æ•°ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ä¾‹ãˆã°ã€ã‚¹ãƒ¬ãƒƒãƒ‰ã®å¾…æ©Ÿæ™‚é–“ã‚’1000ãƒŸãƒªç§’ã«è¨­å®šã—ã€ifæ–‡ã‚’1ç§’ã”ã¨ã«ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ifæ–‡ãŒæ–‡ä¸­ã«ç¾ã‚ŒãŸå ´åˆã¯ã€å¤‰æ•°ã®å€¤ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ã§å¾…æ©Ÿæ™‚é–“ã‚’çŸ­ç¸®ã§ãã¾ã™ã€‚Wait(sleep)

```lua
CreateThread(function()
    while true do
        local sleep = 2500 -- Default wait time
        local ped = PlayerPedId()
        local pos = GetEntityCoords(ped)
        local inRange = #(pos - vector3(-829.11, 75.03, 52.73)) < 10.0

        if inRange then
            sleep = 0 -- Reduce wait time if condition is met
            print('I am in range!')
        else
            print('I am out of range.')
        end

        Wait(sleep)
    end
end)
```

* ã‚¸ãƒ§ãƒ–å›ºæœ‰ã®ãƒ«ãƒ¼ãƒ—ãŒã‚ã‚‹å ´åˆã¯ã€ãã®ã‚¸ãƒ§ãƒ–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã®ã¿é©ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚è­¦å¯Ÿå®˜ã§ã¯ãªã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã€è‡ªåˆ†ã«ã¯é©ç”¨ã•ã‚Œãªã„ãƒ«ãƒ¼ãƒ—ã‚’è‡ªåˆ†ã®ãƒã‚·ãƒ³ã§å®Ÿè¡Œã™ã‚‹ç†ç”±ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```lua
local function exampleJobLoop()
    local job = QBCore.Functions.GetPlayerData().job.name
    CreateThread(function()
        while job == 'police' do
            print('im a policeman!')
            Wait(0)
        end
    end)
end
```

***

### å®‰å…¨

* ã‚³ãƒ¼ãƒ‰ã«éå‰°ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’æ–½ã™ã“ã¨ã¯æ‚ªã„ã“ã¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¤‡æ•°ã®ifæ–‡ã‚’è¿½åŠ ã—ãŸã‚Šã€ã‚¤ãƒ™ãƒ³ãƒˆã«ãƒ©ãƒ³ãƒ€ãƒ å¤‰æ•°ã‚’æ¸¡ã™ã“ã¨ã‚’ãŸã‚ã‚‰ã‚ãªã„ã§ãã ã•ã„ã€‚
* ãƒªã‚½ãƒ¼ã‚¹ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã€ãŠé‡‘ã‚„ã‚¢ã‚¤ãƒ†ãƒ ã«é–¢ã—ã¦playerã¨ã®ã„ã‹ãªã‚‹ç¨®é¡ã®å–å¼•ã‚‚è¡Œã‚ãªã„ã§ãã ã•ã„ã€‚

***

### Event ãƒãƒ³ãƒ‰ãƒ©ãƒ¼

* ãƒªã‚½ãƒ¼ã‚¹å†…ã§å¤‰æ•°ã‚’è¨­å®šã™ã‚‹å ´åˆã€ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã¯ã€å¸¸ã«ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒãªã„ãŸã‚ã€ç‰¹ã«ä¾¿åˆ©ã§ã™ã€‚

```lua
-- These are client-side examples

local isLoggedIn = false
local PlayerData = {}

AddStateBagChangeHandler('isLoggedIn', nil, function(_, _, value) -- FiveM native method
    if value then
        isLoggedIn = true
        PlayerData = QBCore.Functions.GetPlayerData()
    else
        isLoggedIn = false
        PlayerData = {}
    end
end)

AddEventHandler('QBCore:Client:OnPlayerLoaded', function() -- Don't use this with the native method
    isLoggedIn = true
    PlayerData = QBCore.Functions.GetPlayerData()
end)

RegisterNetEvent('QBCore:Client:OnPlayerUnload', function() -- Don't use this with the native method
    isLoggedIn = false
    PlayerData = {}
end)

RegisterNetEvent('QBCore:Client:OnJobUpdate', function(JobInfo)
    PlayerData.job = JobInfo
end)

RegisterNetEvent('QBCore:Player:SetPlayerData', function(val)
    PlayerData = val
end)
```
